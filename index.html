<!doctype html>
<html lang="en"> 
<script src='https://d3js.org/d3.v5.min.js'></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>

<head>
  <title>Michael Potts</title>
</head>

<style> 
    rect {fill: rgb(46, 202, 202); stroke: black;} 
    .button {color: white; text-align: center; display: inline-block; font-size: 16px; cursor: pointer;
            padding: 8px 24px; margin: 4px 2px;}
    .button1 {background-color: rgb(22, 212, 196)}

</style>
<body onload='init()'>
    
    <!-- Header -->
    <div class="full-width header">
        <div class="full-width header-inner">
            <div class="container">
                <div class="title col-sm-8">
                    <h1>Visual Narrative Project</h1>
                    <h2>Fuel Efficiency based on vehicle engine cylinders</h2>
                    <p class="authors" style="font-size: 12px">
                    Michael Potts - July 31st, 2022
                    </p>
                </div>
                <div class="graphic col-sm-4 pull-right">
                </div>
            </div>
        </div>
    </div>
  
    <!-- Intro -->
    <div class="full-width section-intro">
        <div class="container">
            <p id="explanation"></p>
        </div>
    </div>

    <svg width=920 height=540></svg>

    <div class="full-width section-intro">
        <label for="buttonXmin">X minimum</label>
        <input type="number" id='buttonXmin' value=-1>
        <label for="buttonYmin">Y minimum</label>
        <input type="number" id='buttonYmin' value=2>
    </div>

    <div class="full-width section-intro">
        <label for="buttonXmax">X maximum</label>
        <input type="number" id='buttonXmax' value=12>
        <label for="buttonYmax">Y maximum</label>
        <input type="number" id='buttonYmax' value=6>
    </div>

    <button class='button button1' id="button1" onclick="transition_one()">Next scene</button>

    <script>
        async function init() {
            //Load our data and set initial variables
            d3.select('#explanation')
                .text("Vehicles can be created in a variety of ways, but one common theme is, the more power a vehicle needs, the less fuel efficient it usually is.")
            
            var data = await d3.csv("https://flunky.github.io/cars2017.csv");

            var width = 820,
                height = 440,
                margin = 50,
                legendy = [420, 410, 400, 390, 380, 370, 360, 350, 340],
                legendx = 700;

            var xs = d3.scaleLinear().domain([-1,12]).range([0,width]),
                ys = d3.scaleLinear().domain([2,6]).range([height,0]);

            var colour = d3.scaleOrdinal().range(d3.schemeCategory10);
   
            // Create our initial canvas
            d3.select('svg')
                .attr("width", width + 2 * margin)
                .attr("height", height + 2 * margin)
                    .append("g").attr("transform", "translate("+margin+","+margin+")")
                .selectAll('circle')
                .data(data)
                .enter()
                .append('circle')
                    .attr('cx', function(d) {return xs(d.EngineCylinders);})
                    .attr('cy', function(d) {return ys(Math.log(d.AverageCityMPG));})
                    .attr('r', 3)
                    .style('fill', function(d) {return colour(d.EngineCylinders);});

            //Add in our X and Y axis
            d3.select("svg").append("g")
                .attr("transform","translate("+margin+","+margin+")")
                .attr("class", "Yaxis")
                .call(d3.axisLeft(ys).tickValues([2,3,4,5,6])
                );

            d3.select("svg").append("g")
                .attr("class", "Xaxis")
                .attr("transform","translate("+margin+","+(height + margin)+")")
                .call(d3.axisBottom(xs).tickValues([0,2,4,6,8,10,12])
                );
            
            //Add in our axis names
            d3.select("svg").append("text")
                .attr("text-anchor", "end")
                .attr("id", "EngineCylinders")
                .attr("x", width/2 + margin*2.5)
                .attr("y", height + margin + 40)
                .text("Engine Cylinders");

            d3.select("svg").append("text")
                .attr("text-anchor", "end")
                .attr("id", "City")
                .attr("x", -height/2 + margin)
                .attr("y", 15)
                .attr("transform", "rotate(-90)")
                .text("Log miles per gallon - City");

            

            //set listeners for our minimum and maximums
            d3.select('#buttonXmin').on("input", updatePlot_one);
            d3.select('#buttonYmin').on("input", updatePlot_one);
            d3.select('#buttonXmax').on("input", updatePlot_one);
            d3.select('#buttonYmax').on("input", updatePlot_one);
        }

        async function scene_two() {
            //load our data
            var data = await d3.csv("https://flunky.github.io/cars2017.csv");

            var width = 820,
                height = 440,
                margin = 50;

            var xs = d3.scaleLinear().domain([-1,12]).range([0,width]),
                ys = d3.scaleLinear().domain([2,6]).range([height,0]);

            //Transition to Highway MPG
            d3.select('svg').selectAll('circle').data(data).join('circle')
                .attr('cx', function(d) {return xs(d.EngineCylinders);})
                .attr('r', 3)
                .transition().duration(1000)
                    .attr('cy', function(d) {return ys(Math.log(d.AverageHighwayMPG));});

            d3.select('svg').select('#City').remove();

            d3.select("svg").append("text")
                .attr("text-anchor", "end")
                .attr("id", "Highway")
                .attr("x", -height/2 + margin)
                .attr("y", 15)
                .attr("transform", "rotate(-90)")
                .text("Log miles per gallon - Highway");

            //set listeners for our minimum and maximums
            d3.select('#buttonXmin').on("input", updatePlot_two);
            d3.select('#buttonYmin').on("input", updatePlot_two);
            d3.select('#buttonXmax').on("input", updatePlot_two);
            d3.select('#buttonYmax').on("input", updatePlot_two);
        }

        async function transition_one() {
            //update our button
            let btn = document.getElementById('button1');
            btn.setAttribute("onclick", "transition_two()");
            document.body.appendChild(btn);

            //update our text
            d3.select("#explanation")
            .text("In this chart, we can observe Average Highway miles per gallon")

            scene_two();
        }

        async function scene_three() {
            //load our data
            var data = await d3.csv("https://flunky.github.io/cars2017.csv");

            var width = 820,
                height = 440
                margin = 50;

            var xs = d3.scaleLinear().domain([2,5.5]).range([0,width]),
                ys = d3.scaleLinear().domain([2.5,5.5]).range([height,0]);

            //Transition to Highway MPG
            d3.select('svg').selectAll('circle').data(data).join('circle')
                .attr('r', 3)
                .transition().duration(1000)
                    .attr('cx', function(d) {return xs(Math.log(d.AverageCityMPG));})
                    .attr('cy', function(d) {return ys(Math.log(d.AverageHighwayMPG));});

            //update our axis
            d3.select('svg').select('.Xaxis')
                .transition().duration(1000)
                .call(d3.axisBottom(xs));

            d3.select('svg').select('.Yaxis')
                .transition().duration(1000)
                .call(d3.axisLeft(ys));

            d3.select('svg').select('#EngineCylinders').remove();

            d3.select("svg").append("text")
                .attr("text-anchor", "end")
                .attr("x", width/2 + margin*2.5)
                .attr("y", height + margin + 40)
                .text("Log miles per gallon - City");

            //annotations
            const scene_three_ann = d3.annotationsCalloutCircle

            const annotations = [{
                note: {
                    label:"We can see electric vehicles once again at the top of the range.",
                    title:"Electric Vehicles"
                },
                x: 4.5,
                y: 4.5,
                dx: 4,
                dy: 5,
                subject: {
                    radaius: 40,
                    radiusPadding: 5
                }
            }];

            const makeAnnotations = d3.annotation()
                .editMode(true)
                .notePadding(15)
                .type(type)
                .annotations(annotations);
            
            d3.select("svg")
                .append("g")
                .attr("class", "annotation-group")
                .call(makeAnnotations);


            //set listeners for our minimum and maximums
            d3.select('#buttonXmin').on("input", updatePlot_three);
            d3.select('#buttonYmin').on("input", updatePlot_three);
            d3.select('#buttonXmax').on("input", updatePlot_three);
            d3.select('#buttonYmax').on("input", updatePlot_three);
        }

        async function transition_two() {
            //change our button
            let btn = document.getElementById('button1');
            btn.innerHTML = "Reset";
            btn.setAttribute("onclick", "reset()");
            document.body.appendChild(btn);

            //update our text
            d3.select("#explanation")
            .text("Finally, we can compare city mpg to highway miles per gallon")

            //next scene
            scene_three();
        }

        async function reset() {
            //change our button
            let btn = document.getElementById('button1');
            btn.innerHTML = "Next scene";
            btn.setAttribute("onclick", "transition_one()");
            //remove the items from the svg and reset
            d3.select('svg').selectAll('circle').remove();
            d3.select('svg').selectAll('g').remove();
            d3.select('svg').selectAll('text').remove();
            init();
        }
   
        async function updatePlot_one() {
            var data = await d3.csv("https://flunky.github.io/cars2017.csv");
            var Xmin = document.getElementById("buttonXmin").value,
                Ymin = document.getElementById("buttonYmin").value;
                Xmax = document.getElementById("buttonXmax").value,
                Ymax = document.getElementById("buttonYmax").value;

            var width = 820,
                height = 440;

            var xs = d3.scaleLinear().domain([Xmin,Xmax]).range([0,width]),
                ys = d3.scaleLinear().domain([Ymin,Ymax]).range([height,0]);

            d3.select('svg').select('.Xaxis')
                .transition().duration(1000)
                .call(d3.axisBottom(xs));

            d3.select('svg').select('.Yaxis')
                .transition().duration(1000)
                .call(d3.axisLeft(ys));

            d3.select('svg').selectAll('circle')
                .data(data)
                .transition().duration(1000)
                .attr('cx', function(d) {return xs(d.EngineCylinders);})
                .attr('cy', function(d) {return ys(Math.log(d.AverageCityMPG));});
        }

        async function updatePlot_two() {
            var data = await d3.csv("https://flunky.github.io/cars2017.csv");
            var Xmin = document.getElementById("buttonXmin").value,
                Ymin = document.getElementById("buttonYmin").value;
                Xmax = document.getElementById("buttonXmax").value,
                Ymax = document.getElementById("buttonYmax").value;

            var width = 820,
                height = 440;

            var xs = d3.scaleLinear().domain([Xmin,Xmax]).range([0,width]),
                ys = d3.scaleLinear().domain([Ymin,Ymax]).range([height,0]);

            d3.select('svg').select('.Xaxis')
                .transition().duration(1000)
                .call(d3.axisBottom(xs));

            d3.select('svg').select('.Yaxis')
                .transition().duration(1000)
                .call(d3.axisLeft(ys));

            d3.select('svg').selectAll('circle')
                .data(data)
                .transition().duration(1000)
                .attr('cx', function(d) {return xs(d.EngineCylinders);})
                .attr('cy', function(d) {return ys(Math.log(d.AverageHighwayMPG));});
        }

        async function updatePlot_three() {
            var data = await d3.csv("https://flunky.github.io/cars2017.csv");
            var Xmin = document.getElementById("buttonXmin").value,
                Ymin = document.getElementById("buttonYmin").value;
                Xmax = document.getElementById("buttonXmax").value,
                Ymax = document.getElementById("buttonYmax").value;

            var width = 820,
                height = 440;

            var xs = d3.scaleLinear().domain([Xmin,Xmax]).range([0,width]),
                ys = d3.scaleLinear().domain([Ymin,Ymax]).range([height,0]);

            d3.select('svg').select('.Xaxis')
                .transition().duration(1000)
                .call(d3.axisBottom(xs));

            d3.select('svg').select('.Yaxis')
                .transition().duration(1000)
                .call(d3.axisLeft(ys));

            d3.select('svg').selectAll('circle')
                .data(data)
                .transition().duration(1000)
                .attr('cx', function(d) {return xs(Math.log(d.AverageCityMPG));})
                .attr('cy', function(d) {return ys(Math.log(d.AverageHighwayMPG));});
        }

    </script>      
</body>
</html>
